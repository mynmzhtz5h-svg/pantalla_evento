<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pantalla Evento</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle at center, #222 0%, #000 70%);
  color: #fff;
  font-family: system-ui, sans-serif;
  overflow: hidden;
}

/* CONTENEDOR GENERAL */
#escenario {
  position: relative;
  width: 100%;
  height: 100%;
}

/* LOGO */
#logo {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 220px;
  z-index: 10;
}

/* QR */
#qr {
  position: absolute;
  inset: 0;
  margin: auto;
  width: 420px;
  height: 420px;
  background: #fff;
  padding: 20px;
  border-radius: 24px;
  box-shadow: 0 0 60px rgba(0,0,0,.8);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 1s ease;
  z-index: 5;
}

#qr img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* TEXTO BAJO QR GRANDE */
#qr-inicial-texto {
  position: absolute;
  top: calc(50% + 240px);
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  font-size: 24px;
  font-weight: 600;
  line-height: 1.3;
  opacity: 1;
  transition: opacity 1s;
}

/* QR chico */
#qr.chico {
  width: 140px;
  height: 140px;
  bottom: 30px;
  right: 30px;
  top: auto;
  left: auto;
  margin: 0;
}

/* cuando QR es chico, ocultar texto inicial */
#qr.chico ~ #qr-inicial-texto {
  opacity: 0;
}

/* TEXTO QR CHICO */
#qr-texto {
  position: absolute;
  bottom: 180px;
  right: 30px;
  font-size: 16px;
  text-align: center;
  opacity: 0;
  transition: opacity 1s;
}

#qr.chico + #qr-texto {
  opacity: 1;
}

/* CARRUSEL */
#carrusel {
  position: absolute;
  inset: 0;
  display: none;
}

#foto {
  width: 100%;
  height: 100%;
  object-fit: contain;
  animation: fade 1s ease;
}

/* INFO */
#info {
  position: absolute;
  left: 40px;
  bottom: 80px;
  max-width: 40%;
  padding: 24px;
  border-radius: 18px;
  background: linear-gradient(135deg, #00ffcc, #0066ff);
  color: #000;
  font-size: 20px;
  box-shadow: 0 20px 40px rgba(0,0,0,.5);
  animation: glow 6s infinite alternate;
}

/* ANIMACIONES */
@keyframes fade {
  from { opacity: 0 }
  to { opacity: 1 }
}

@keyframes glow {
  from { filter: hue-rotate(0deg) }
  to { filter: hue-rotate(60deg) }
}
</style>
</head>

<body>

<div id="escenario">

  <img id="logo" src="logo.png" alt="Logo">

  <div id="qr">
    <img src="qr.png" alt="QR">
  </div>

  <div id="qr-texto">
    SUBÍ TU FOTO<br>Y SÉ PARTE DE LA FIESTA!
  </div>

  <div id="qr-inicial-texto">
    Escaneá el QR<br>
    Subí tu foto y sé parte de la fiesta!
  </div>

  <div id="carrusel">
    <img id="foto">
    <div id="info"></div>
  </div>

</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
  "https://mjmbvzvirvtsihtyrqqf.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1qbWJ2enZpcnZ0c2lodHlycXFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NDk2ODUsImV4cCI6MjA4NTIyNTY4NX0.ZHo3Tsi2GwJFvW3iwOKBQ6c_6KhHx2Ju8wUrU223zkU"
);

const DURACION = 8000;
let fotos = [];
let indice = 0;

const qr = document.getElementById("qr");
const carrusel = document.getElementById("carrusel");
const img = document.getElementById("foto");
const info = document.getElementById("info");

async function cargarFotos() {
  const { data } = await supabase.storage.from("evento").list("", { limit: 100 });
  return (data || []).filter(f => /\.(jpg|jpeg|png)$/i.test(f.name));
}

async function iniciar() {
  fotos = await cargarFotos();

  if (!fotos.length) {
    carrusel.style.display = "none";
    qr.classList.remove("chico");
    return;
  }

  qr.classList.add("chico");
  carrusel.style.display = "block";
  mostrar();
}

function mostrar() {
  const f = fotos[indice];
  img.src = supabase.storage.from("evento").getPublicUrl(f.name).data.publicUrl;

  const partes = f.name.split("___");
  info.innerHTML = `<strong>${partes[0]}</strong><br>${(partes[1]||"").replace(/_/g," ")}`;

  indice = (indice + 1) % fotos.length;
  setTimeout(mostrar, DURACION);
}

setInterval(iniciar, 10000);
iniciar();
</script>

</body>
</html>
