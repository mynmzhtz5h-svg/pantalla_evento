<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pantalla Evento</title>
<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: system-ui, sans-serif;
    overflow: hidden;
  }

  /* Logo */
  #branding {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10;
    transition: all .6s ease;
  }
  #branding img {
    width: 50vw;
    max-width: 420px;
  }
  #branding.mini img {
    width: 160px;
  }

  /* Pantalla inicial con QR gigante */
  #inicio {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 24px;
    text-align: center;
    transition: opacity 0.8s;
  }
  #inicio img {
    width: 260px;
    background: white;
    padding: 16px;
    border-radius: 18px;
  }

  /* QR mini al fondo */
  #qr-mini {
    position: absolute;
    bottom: 20px;
    right: 20px;
    width: 120px;
    background: white;
    padding: 10px;
    border-radius: 12px;
    display: none;
    z-index: 9;
  }

  /* Texto con nombre y mensaje */
  #texto {
    position: absolute;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,.6);
    padding: 12px 20px;
    border-radius: 14px;
    font-size: 22px;
    display: none;
    text-align: center;
    transition: opacity 1s;
  }

  /* Escenario de fotos */
  #escenario {
    position: absolute;
    inset: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1; /* detrás de branding, QR y texto */
  }
  #escenario img.slide {
    max-width: 90vw;
    max-height: 80vh;
    object-fit: contain;
    position: absolute;
    opacity: 0;
    transition: opacity 1s ease-in-out;
  }
  #escenario img.slide.activa {
    opacity: 1;
  }
</style>
</head>
<body>

<!-- Logo -->
<div id="branding">
  <img src="logo.png">
</div>

<!-- Pantalla inicial con QR gigante -->
<div id="inicio">
  <img src="https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=https://mynmzhtz5h-svg.github.io/subida-fotos-evento/">
  <p>Escaneá el QR y subí tu foto</p>
</div>

<!-- QR mini que aparece al iniciar carrusel -->
<img id="qr-mini"
src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=https://mynmzhtz5h-svg.github.io/subida-fotos-evento/">

<!-- Texto de nombre y mensaje -->
<div id="texto"></div>

<!-- Contenedor de fotos -->
<div id="escenario"></div>

<script>
const cloudName = "craneosuy";  // tu Cloudinary
const folder = "evento-qr";      // carpeta donde se suben las fotos
const updateInterval = 30000;     // refresco fotos nuevas cada 30s
let fotos = [];
let i = 0;

// Traer fotos de Cloudinary
async function cargarFotos() {
  try {
    const res = await fetch(`https://res.cloudinary.com/${cloudName}/image/list/${folder}.json`);
    const data = await res.json();
    fotos = data.resources
      .sort((a,b) => b.created_at.localeCompare(a.created_at))
      .map(item => ({
        secure_url: `https://res.cloudinary.com/${cloudName}/image/upload/${item.public_id}.${item.format}`,
        public_id: item.public_id
      }));
  } catch(err) {
    console.error("Error cargando fotos:", err);
    fotos = [];
  }
}

// Mostrar foto con fade
function mostrar() {
  if (!fotos.length) return;

  // Ocultar pantalla inicial
  const inicio = document.getElementById("inicio");
  inicio.style.opacity = 0;
  setTimeout(() => inicio.style.display = "none", 800);

  // Mostrar QR mini y achicar logo
  const qrMini = document.getElementById("qr-mini");
  qrMini.style.display = "block";
  document.getElementById("branding").classList.add("mini");

  // Escenario
  const escenario = document.getElementById("escenario");

  // Quitar slides anteriores
  document.querySelectorAll("#escenario img.slide").forEach(e => e.remove());

  const f = fotos[i];
  const img = document.createElement("img");
  img.src = f.secure_url;
  img.className = "slide activa";
  escenario.appendChild(img);

  // Extraer nombre y mensaje del public_id
  const partes = f.public_id.split("/")[1]?.split("___");
  const nombre = partes?.[0]?.replace(/_/g," ") || "";
  const mensaje = partes?.[1]?.replace(/_/g," ") || "";

  const texto = document.getElementById("texto");
  texto.innerHTML = `<strong>${nombre}</strong><br>${mensaje}`;
  texto.style.display = "block";
  texto.style.opacity = 1;

  i = (i + 1) % fotos.length;
}

// Carrusel automático cada 5s
async function loop() {
  await cargarFotos();
  mostrar();
  setTimeout(loop, 5000);
}

// Refrescar fotos nuevas cada 30s
setInterval(cargarFotos, updateInterval);

// Inicia el loop
loop();
</script>

</body>
</html>
