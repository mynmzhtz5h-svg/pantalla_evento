<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pantalla Evento</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:radial-gradient(circle at top,#111,#000);
  color:#fff;
  font-family:system-ui,sans-serif;
  overflow:hidden;
}

#logo{
  position:absolute;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  width:200px;
  z-index:10;
}

#contenedor{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
}

#foto{
  max-width:100%;
  max-height:100%;
  object-fit:contain;
  opacity:0;
  transition:opacity 1s ease;
  display:none; /* üîë CLAVE */
}

#qrGrande{
  width:420px;
  opacity:0;
  transition:opacity 1s ease;
}

#qrMini{
  position:absolute;
  bottom:30px;
  right:30px;
  width:140px;
  opacity:0;
  transition:opacity 1s ease;
}

#textoQR{
  position:absolute;
  bottom:190px;
  right:30px;
  width:260px;
  text-align:center;
  font-size:18px;
  font-weight:700;
  opacity:0;
  transition:opacity 1s ease;
}

#info{
  position:absolute;
  left:40px;
  max-width:420px;
  padding:20px;
  border-radius:16px;
  background:linear-gradient(135deg,#00ffcc,#0066ff);
  color:#000;
  opacity:0;
  transition:opacity 1s ease;
}

#nombre{
  font-size:24px;
  font-weight:800;
}

#mensaje{
  font-size:18px;
  margin-top:8px;
}
</style>
</head>

<body>

<img id="logo" src="logo.png">
<div id="contenedor">
  <img id="foto">
  <img id="qrGrande" src="qr.png">
  <img id="qrMini" src="qr.png">
</div>

<div id="textoQR">SUB√ç TU FOTO Y S√â PARTE DE LA FIESTA!</div>

<div id="info">
  <div id="nombre"></div>
  <div id="mensaje"></div>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
  "https://mjmbvzvirvtsihtyrqqf.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1qbWJ2enZpcnZ0c2lodHlycXFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NDk2ODUsImV4cCI6MjA4NTIyNTY4NX0.ZHo3Tsi2GwJFvW3iwOKBQ6c_6KhHx2Ju8wUrU223zkU"
);

const foto = document.getElementById("foto");
const qrGrande = document.getElementById("qrGrande");
const qrMini = document.getElementById("qrMini");
const textoQR = document.getElementById("textoQR");
const info = document.getElementById("info");
const nombreEl = document.getElementById("nombre");
const mensajeEl = document.getElementById("mensaje");

let fotos = [];
let index = 0;
let carruselActivo = false;

function mostrarQR() {
  qrGrande.style.opacity = 1;
  qrMini.style.opacity = 0;
  textoQR.style.opacity = 0;
  foto.style.opacity = 0;
  foto.style.display = "none";
  info.style.opacity = 0;
}

function iniciarCarrusel() {
  carruselActivo = true;
  qrGrande.style.opacity = 0;
  qrMini.style.opacity = 1;
  textoQR.style.opacity = 1;
  foto.style.display = "block";
  mostrarFoto();
}

function mostrarFoto() {
  const f = fotos[index];
  foto.src = f.url;
  nombreEl.textContent = f.nombre || "";
  mensajeEl.textContent = f.mensaje || "";
  foto.style.opacity = 1;
  info.style.opacity = 1;

  setTimeout(() => {
    foto.style.opacity = 0;
    info.style.opacity = 0;
    index++;

    if (index >= fotos.length) {
      carruselActivo = false;
      index = 0;
      mostrarQR();
      setTimeout(() => {
        if (fotos.length) iniciarCarrusel();
      }, 10000);
    } else {
      setTimeout(mostrarFoto, 1000);
    }
  }, 8000);
}

async function cargarFotos() {
  const { data } = await supabase.storage.from("evento").list("", { limit: 100 });

  const validas = (data || []).filter(f =>
    /\.(jpg|jpeg|png)$/i.test(f.name)
  );

  if (!validas.length) {
    mostrarQR();
    return;
  }

  fotos = validas.reverse().map(f => {
    const p = f.name.split("___");
    return {
      url: supabase.storage.from("evento").getPublicUrl(f.name).data.publicUrl,
      nombre: p[0]?.replace(/_/g," "),
      mensaje: p[1]?.replace(/_/g," ")
    };
  });

  if (!carruselActivo) {
    mostrarQR();
    setTimeout(iniciarCarrusel, 10000);
  }
}

mostrarQR();
cargarFotos();
setInterval(cargarFotos, 10000);
</script>

</body>
</html>
