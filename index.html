<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pantalla Evento</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{
  margin:0;height:100%;
  background:radial-gradient(circle,#222,#000);
  font-family:system-ui;
  overflow:hidden;
}
#branding{position:absolute;top:20px;left:50%;transform:translateX(-50%);z-index:10}
#branding img{width:200px}

#carousel{position:absolute;top:180px;left:50%;transform:translateX(-50%);
  width:90%;height:60vh;display:flex;justify-content:center;align-items:center}

.slide{max-width:100%;max-height:100%;opacity:0;transition:opacity 1s}
.slide.activa{opacity:1}

#qr{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
  text-align:center;transition:all 1s;z-index:5}
#qr.chico{left:auto;right:20px;top:50%;transform:translateY(-50%);width:120px}
#qr img{width:50%;border-radius:16px}

#qr div {
  margin-top: 10px;
  color: #fff;
  font-size: 20px;
  font-weight: 600;
  text-shadow: 0 2px 6px rgba(0,0,0,.8);
}

#autor{position:absolute;bottom:40px;left:20px;color:#fff;display:none}
#autor span{display:block;font-size:18px}
</style>
</head>

<body>
<div id="branding"><img src="logo.png"></div>
<div id="carousel"></div>

<div id="qr">
  <img src="qr.png">
  <div>EscaneÃ¡ y subÃ­ tu foto ðŸ“¸</div>
</div>

<div id="autor">
  <span id="nombre"></span>
  <span id="mensaje"></span>
</div>

<script>
const CLOUD="craneosuy";
const LIST_URL=`https://res.cloudinary.com/${CLOUD}/image/list/evento-qr.json`;

let fotos=[], idx=0;

async function cargar(){
  try{
    const r=await fetch(LIST_URL+"?"+Date.now());
    const j=await r.json();
    fotos=j.resources.reverse();
  }catch{fotos=[]}
}

async function loop(){
  await cargar();
  if(!fotos.length){
    qr.classList.remove("chico");
    autor.style.display="none";
    setTimeout(loop,10000);
    return;
  }

  qr.classList.add("chico");

  for(const f of fotos){
    carousel.innerHTML="";
    const img=document.createElement("img");
    img.src=f.secure_url;
    img.className="slide activa";
    carousel.appendChild(img);

    const p=f.public_id.split("___");
    nombre.textContent=p[0];
    mensaje.textContent=p[1];
    autor.style.display="block";

    await new Promise(r=>setTimeout(r,5000));
  }

  carousel.innerHTML="";
  autor.style.display="none";
  qr.classList.remove("chico");
  setTimeout(loop,10000);
}

loop();
</script>
</body>
</html>
