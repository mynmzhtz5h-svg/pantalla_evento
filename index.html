<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pantalla Evento</title>

<style>
body {
  margin: 0;
  background: black;
  color: white;
  font-family: system-ui, sans-serif;
  overflow: hidden;
}

/* LOGO SIEMPRE ARRIBA */
#branding {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
}
#branding img {
  width: 300px;
}

/* INICIO QR */
#inicio {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 24px;
  text-align: center;
  z-index: 5;
}
#inicio img {
  width: 320px;
  background: white;
  padding: 18px;
  border-radius: 20px;
}

/* ESCENARIO */
#escenario {
  position: absolute;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
}
.slide {
  position: absolute;
  max-width: 85vw;
  max-height: 75vh;
  object-fit: contain;
  opacity: 0;
  transition: opacity 1.2s ease;
}
.slide.activa {
  opacity: 1;
}

/* TEXTO LATERAL */
#info {
  position: absolute;
  left: 40px;
  top: 50%;
  transform: translateY(-50%);
  max-width: 360px;
  padding: 22px;
  border-radius: 18px;
  background: linear-gradient(270deg, #00ffcc, #0066ff, #00ff99);
  background-size: 600% 600%;
  animation: colores 6s ease infinite;
  display: none;
  z-index: 8;
}
#info strong {
  font-size: 26px;
}
#info p {
  margin-top: 10px;
  font-size: 20px;
}

@keyframes colores {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* QR MINI */
#qr-mini {
  position: absolute;
  bottom: 20px;
  right: 20px;
  text-align: center;
  display: none;
  z-index: 9;
}
#qr-mini img {
  width: 120px;
  background: white;
  padding: 10px;
  border-radius: 14px;
}
#qr-mini span {
  display: block;
  margin-top: 6px;
  font-size: 14px;
}
</style>
</head>

<body>

<div id="branding">
  <img src="logo.png">
</div>

<div id="inicio">
  <img src="https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=https://mynmzhtz5h-svg.github.io/subida-fotos-evento/">
  <p>Escane√° el QR y sub√≠ tu foto üì∏</p>
</div>

<div id="qr-mini">
  <img src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=https://mynmzhtz5h-svg.github.io/subida-fotos-evento/">
  <span>SUB√ç TU FOTO Y SE PARTE DE LA FIESTA!</span>
</div>

<div id="info"></div>
<div id="escenario"></div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
  "https://mjmbvzvirvtsihtyrqqf.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1qbWJ2enZpcnZ0c2lodHlycXFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NDk2ODUsImV4cCI6MjA4NTIyNTY4NX0.ZHo3Tsi2GwJFvW3iwOKBQ6c_6KhHx2Ju8wUrU223zkU"
);

let fotos = [];
let index = 0;
let mostrandoQR = true;

async function cargarFotos() {
  const { data } = await supabase.storage.from("evento").list("", {
    sortBy: { column: "created_at", order: "desc" }
  });
  fotos = data || [];
}

function mostrarQR() {
  document.getElementById("inicio").style.display = "flex";
  document.getElementById("qr-mini").style.display = "none";
  document.getElementById("info").style.display = "none";
  document.querySelectorAll(".slide").forEach(e => e.remove());
}

function mostrarFoto() {
  if (!fotos.length) return;

  document.getElementById("inicio").style.display = "none";
  document.getElementById("qr-mini").style.display = "block";

  const f = fotos[index];
  const img = document.createElement("img");
  img.src = `https://mjmbvzvirvtsihtyrqqf.supabase.co/storage/v1/object/public/evento/${f.name}`;
  img.className = "slide activa";
  document.getElementById("escenario").appendChild(img);

  document.querySelectorAll(".slide:not(:last-child)").forEach(e => e.remove());

  const partes = f.name.split("___");
  const nombre = partes[0].replace(/_/g, " ");
  const mensaje = partes[1]?.replace(/_/g, " ");

  const info = document.getElementById("info");
  info.innerHTML = `<strong>${nombre}</strong><p>${mensaje || ""}</p>`;
  info.style.display = "block";

  index++;
  if (index >= fotos.length) {
    index = 0;
    setTimeout(() => mostrarQR(), 8000);
    setTimeout(() => iniciarCarrusel(), 18000);
  }
}

async function iniciarCarrusel() {
  await cargarFotos();
  mostrarFoto();
  setInterval(mostrarFoto, 8000);
}

mostrarQR();
setTimeout(iniciarCarrusel, 10000);
setInterval(cargarFotos, 10000);
</script>

</body>
</html>
