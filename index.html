<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pantalla Evento</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle at center, #222 0%, #000 70%);
  font-family: system-ui, sans-serif;
  overflow: hidden;
}

/* ESCENARIO GENERAL */
#escenario {
  position: relative;
  width: 100%;
  height: 100%;
}

/* LOGO */
#logo {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 220px;
  z-index: 10;
}

/* QR GRANDE Y CHICO */
#qr {
  position: absolute;
  inset: 0;
  margin: auto;
  width: 420px;
  height: 420px;
  background: #fff;
  padding: 20px;
  border-radius: 24px;
  box-shadow: 0 0 60px rgba(0,0,0,.8);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 1s ease;
  z-index: 5;
  cursor: pointer;
}

#qr img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* TEXTO BAJO QR GRANDE */
#qr-inicial-texto {
  position: absolute;
  top: calc(50% + 240px);
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  font-size: 24px;
  font-weight: 600;
  line-height: 1.3;
  opacity: 1;
  transition: opacity 1s;
}

/* QR CHICO */
#qr.chico {
  width: 140px;
  height: 140px;
  bottom: 30px;
  right: 30px;
  top: auto;
  left: auto;
  margin: 0;
}

/* ocultar texto inicial cuando QR es chico */
#qr.chico ~ #qr-inicial-texto {
  opacity: 0;
}

/* TEXTO DEL QR CHICO */
#qr-texto {
  position: absolute;
  bottom: 180px;
  right: 30px;
  font-size: 16px;
  text-align: center;
  opacity: 0;
  transition: opacity 1s;
}

#qr.chico + #qr-texto {
  opacity: 1;
}

/* CONTENEDOR DEL CARRUSEL */
#carrusel-contenedor {
  position: absolute;
  top: 100px; /* espacio debajo del logo */
  left: 0;
  right: 0;
  bottom: 60px; /* espacio para QR chico y texto */
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1;
}

/* IMAGEN DEL CARRUSEL */
#carrusel {
  width: 90%;
  height: 90%;
  position: relative;
}

#carrusel img {
  position: absolute;
  width: 100%;
  height: 100%;
  object-fit: contain;
  opacity: 0;
  transition: opacity 1s ease;
}

#carrusel img.activa {
  opacity: 1;
}

/* INFO FOTO */
#info {
  position: absolute;
  left: 40px;
  bottom: 40px;
  max-width: 40%;
  padding: 24px;
  border-radius: 18px;
  background: linear-gradient(135deg, #00ffcc, #0066ff);
  color: #000;
  font-size: 20px;
  box-shadow: 0 20px 40px rgba(0,0,0,.5);
  animation: glow 6s infinite alternate;
}

@keyframes glow {
  from { filter: hue-rotate(0deg) }
  to { filter: hue-rotate(60deg) }
}
</style>
</head>

<body>

<div id="escenario">
  <img id="logo" src="logo.png" alt="Logo">

  <!-- QR CLICKEABLE -->
  <a id="qr" href="https://mynmzhtz5h-svg.github.io/subida-fotos-evento/" target="_blank">
    <img src="qr.png" alt="QR">
  </a>

  <div id="qr-texto">
    SUBÍ TU FOTO<br>Y SÉ PARTE DE LA FIESTA!
  </div>

  <div id="qr-inicial-texto">
    Escaneá el QR<br>
    Subí tu foto y sé parte de la fiesta!
  </div>

  <div id="carrusel-contenedor">
    <div id="carrusel"></div>
    <div id="info"></div>
  </div>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
  "https://mjmbvzvirvtsihtyrqqf.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1qbWJ2enZpcnZ0c2lodHlycXFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NDk2ODUsImV4cCI6MjA4NTIyNTY4NX0.ZHo3Tsi2GwJFvW3iwOKBQ6c_6KhHx2Ju8wUrU223zkU"
);

const DURACION = 10000; // 10s
let fotos = [];
let indice = 0;

const qr = document.getElementById("qr");
const carrusel = document.getElementById("carrusel");
const info = document.getElementById("info");

async function cargarFotos() {
  const { data } = await supabase.storage.from("evento").list("", { limit: 100 });
  return (data || []).filter(f => /\.(jpg|jpeg|png)$/i.test(f.name));
}

async function iniciarCarrusel() {
  const nuevasFotos = await cargarFotos();
  if (nuevasFotos.length > fotos.length) {
    // insertar nuevas al inicio
    fotos = nuevasFotos.concat(fotos.slice(fotos.length));
  } else if (fotos.length === 0 && nuevasFotos.length > 0) {
    fotos = nuevasFotos;
  }

  if (!fotos.length) {
    // no hay fotos, mostrar solo QR grande
    carrusel.innerHTML = "";
    qr.classList.remove("chico");
    return;
  }

  // iniciar carrusel
  qr.classList.add("chico");
  carrusel.innerHTML = "";
  indice = 0;
  mostrarFoto();
}

function mostrarFoto() {
  carrusel.innerHTML = "";
  const f = fotos[indice];
  const img = document.createElement("img");
  img.src = supabase.storage.from("evento").getPublicUrl(f.name).data.publicUrl;
  img.classList.add("activa");
  carrusel.appendChild(img);

  // info
  const partes = f.name.split("___");
  info.innerHTML = `<strong>${partes[0]}</strong><br>${(partes[1]||"").replace(/_/g," ")}`;

  indice++;
  if (indice >= fotos.length) {
    // fin carrusel, volver QR grande después de 10s
    setTimeout(() => {
      indice = 0;
      fotos = fotos; // mantener fotos
      carrusel.innerHTML = "";
      qr.classList.remove("chico");
    }, 10000);
  } else {
    setTimeout(mostrarFoto, DURACION);
  }
}

// chequear nuevas fotos cada 10s
setInterval(iniciarCarrusel, 10000);
iniciarCarrusel();
</script>

</body>
</html>
